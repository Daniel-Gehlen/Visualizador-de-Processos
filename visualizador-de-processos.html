<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visualizador de Processos</title>
  <style>
    :root {
      --primary: #4a6fa5;
      --secondary: #166088;
      --success: #4caf50;
      --warning: #ff9800;
      --danger: #f44336;
      --light: #f8f9fa;
      --dark: #343a40;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    h1 {
      color: var(--secondary);
      margin-bottom: 10px;
    }
    
    .controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    button {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
    }
    
    button:hover {
      background-color: var(--secondary);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    button.danger {
      background-color: var(--danger);
    }
    
    button.success {
      background-color: var(--success);
    }
    
    button.warning {
      background-color: var(--warning);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .close-modal {
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }
    
    .close-modal:hover {
      color: #333;
    }
    
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: inherit;
    }
    
    textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .progress-container {
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 5px;
      margin-bottom: 20px;
      height: 20px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-bar {
      height: 100%;
      background-color: var(--success);
      width: 0%;
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
      font-weight: bold;
    }
    
    .tree-container {
      width: 100%;
      overflow-x: auto;
      padding: 20px 0;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      min-height: 200px;
    }
    
    .tree {
      display: flex;
      justify-content: center;
      min-height: 200px;
    }
    
    .empty-state {
      text-align: center;
      color: #999;
      padding: 40px;
    }
    
    .node {
      border: 2px solid var(--primary);
      border-radius: 8px;
      padding: 15px;
      margin: 10px;
      background-color: white;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      min-width: 200px;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .node.completed {
      background-color: #e8f5e9;
      border-color: var(--success);
    }
    
    .node.completed .node-title {
      color: var(--success);
    }
    
    .node-title {
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--primary);
      word-wrap: break-word;
    }
    
    .node-description {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
      word-wrap: break-word;
    }
    
    .node-actions {
      display: flex;
      gap: 5px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .node-actions button {
      padding: 5px 10px;
      font-size: 12px;
    }
    
    .children {
      display: flex;
      justify-content: center;
      position: relative;
      flex-direction: column;
      align-items: center;
    }
    
    .connector {
      width: 2px;
      height: 20px;
      background-color: var(--primary);
      margin: 0 auto;
    }
    
    .level {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    
    .level.horizontal {
      flex-direction: row;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .file-upload {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .file-upload-button {
      background-color: var(--warning);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .file-upload-button:hover {
      background-color: #e68900;
      transform: translateY(-2px);
    }
    
    .file-preview {
      border: 1px dashed #ccc;
      padding: 15px;
      border-radius: 5px;
      max-height: 150px;
      overflow-y: auto;
      background-color: #f9f9f9;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }
    
    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
      }
      
      .node {
        min-width: 150px;
      }
      
      .level.horizontal {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Visualizador de Processos</h1>
      <p>Organize e visualize hierarquias de tarefas</p>
    </header>
    
    <div class="file-upload">
      <button class="file-upload-button" id="file-upload-btn">üìÅ Carregar Documento de Texto</button>
      <input type="file" id="file-input" accept=".txt" style="display: none;">
      <div class="file-preview" id="file-preview" style="display: none;"></div>
    </div>
    
    <div class="controls">
      <button id="add-problem">‚ûï Adicionar Processo</button>
      <button id="build-tree" disabled>üå≥ Construir √Årvore</button>
      <button id="clear-all">üóëÔ∏è Limpar Tudo</button>
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar">0%</div>
      </div>
    </div>
    
    <div class="tree-container">
      <div class="tree" id="tree">
        <div class="empty-state">
          <p>Nenhum processo adicionado ainda.</p>
          <p>Adicione um processo ou carregue um arquivo para come√ßar.</p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal" id="problem-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Adicionar Processo</h2>
        <span class="close-modal">&times;</span>
      </div>
      <input type="text" id="problem-title" placeholder="T√≠tulo do Processo">
      <textarea id="problem-description" placeholder="Descri√ß√£o do Processo (opcional)"></textarea>
      <button id="save-problem">üíæ Salvar</button>
    </div>
  </div>
  
  <script>
    let problems = [];
    let editingId = null;
    let editingParentId = null;
    let totalNodes = 0;
    let completedNodes = 0;
    
    const addProblemBtn = document.getElementById('add-problem');
    const buildTreeBtn = document.getElementById('build-tree');
    const clearAllBtn = document.getElementById('clear-all');
    const problemModal = document.getElementById('problem-modal');
    const closeModal = document.querySelector('.close-modal');
    const saveProblemBtn = document.getElementById('save-problem');
    const problemTitle = document.getElementById('problem-title');
    const problemDescription = document.getElementById('problem-description');
    const modalTitle = document.getElementById('modal-title');
    const treeContainer = document.getElementById('tree');
    const progressBar = document.getElementById('progress-bar');
    const fileInput = document.getElementById('file-input');
    const filePreview = document.getElementById('file-preview');
    const fileUploadBtn = document.getElementById('file-upload-btn');

    fileUploadBtn.addEventListener('click', () => {
      fileInput.click();
    });

    addProblemBtn.addEventListener('click', () => {
      openModal();
    });

    closeModal.addEventListener('click', () => {
      closeModalWindow();
    });

    problemModal.addEventListener('click', (e) => {
      if (e.target === problemModal) {
        closeModalWindow();
      }
    });

    saveProblemBtn.addEventListener('click', saveProblem);
    buildTreeBtn.addEventListener('click', buildTree);
    clearAllBtn.addEventListener('click', clearAll);

    fileInput.addEventListener('change', handleFileUpload);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && problemModal.style.display === 'flex') {
        closeModalWindow();
      }
    });

    function openModal(parentId = null, title = 'Adicionar Processo') {
      editingId = null;
      editingParentId = parentId;
      modalTitle.textContent = title;
      problemTitle.value = '';
      problemDescription.value = '';
      problemModal.style.display = 'flex';
      problemTitle.focus();
    }

    function closeModalWindow() {
      problemModal.style.display = 'none';
      editingId = null;
      editingParentId = null;
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (!file.name.toLowerCase().endsWith('.txt')) {
        alert('Por favor, selecione um arquivo de texto (.txt)');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const content = e.target.result;
        filePreview.textContent = content;
        filePreview.style.display = 'block';
        parseTextContent(content);
      };
      reader.onerror = () => {
        alert('Erro ao ler o arquivo');
      };
      reader.readAsText(file);
    }

    function parseTextContent(text) {
      const lines = text.split('\n').filter(line => line.trim());
      problems = [];
      
      const stack = [];
      
      lines.forEach(line => {
        const level = (line.match(/^\s*/)[0].length / 2) || 0;
        const title = line.trim();
        
        const newProblem = {
          id: generateId(),
          title,
          description: '',
          subproblems: [],
          completed: false
        };
        
        while (stack.length > level) {
          stack.pop();
        }
        
        if (stack.length === 0) {
          problems.push(newProblem);
        } else {
          const parent = stack[stack.length - 1];
          if (!parent.subproblems) {
            parent.subproblems = [];
          }
          parent.subproblems.push(newProblem);
        }
        
        stack.push(newProblem);
      });
      
      updateButtons();
      if (problems.length > 0) {
        buildTree();
      }
    }

    function generateId() {
      return Date.now().toString() + Math.random().toString(36).substr(2, 9);
    }

    function saveProblem() {
      const title = problemTitle.value.trim();
      const description = problemDescription.value.trim();
      
      if (!title) {
        alert('Por favor, insira um t√≠tulo para o processo');
        problemTitle.focus();
        return;
      }
      
      const newProblem = {
        id: editingId || generateId(),
        title,
        description,
        subproblems: [],
        completed: false
      };
      
      if (editingId) {
        updateProblem(editingId, newProblem);
      } else if (editingParentId) {
        const parent = findProblem(editingParentId, problems);
        if (parent) {
          if (!parent.subproblems) {
            parent.subproblems = [];
          }
          parent.subproblems.push(newProblem);
        }
      } else {
        problems.push(newProblem);
      }
      
      closeModalWindow();
      updateButtons();
      buildTree();
    }

    function updateProblem(id, updatedProblem) {
      function updateInList(list) {
        for (let i = 0; i < list.length; i++) {
          if (list[i].id === id) {
            list[i] = { ...list[i], ...updatedProblem };
            return true;
          }
          if (list[i].subproblems && updateInList(list[i].subproblems)) {
            return true;
          }
        }
        return false;
      }
      updateInList(problems);
    }

    function updateButtons() {
      buildTreeBtn.disabled = problems.length === 0;
    }

    function clearAll() {
      if (problems.length === 0) return;
      
      if (confirm('Tem certeza que deseja limpar todos os processos?')) {
        problems = [];
        filePreview.style.display = 'none';
        fileInput.value = '';
        updateButtons();
        showEmptyState();
        updateProgressBar();
      }
    }

    function buildTree() {
      totalNodes = calculateTotalNodes(problems);
      completedNodes = calculateCompletedNodes(problems);
      updateProgressBar();
      
      treeContainer.innerHTML = '';
      
      if (problems.length === 0) {
        showEmptyState();
        return;
      }
      
      const treeWrapper = document.createElement('div');
      treeWrapper.className = 'level';
      
      problems.forEach(problem => {
        const nodeContainer = document.createElement('div');
        nodeContainer.appendChild(createNodeElement(problem));
        
        if (problem.subproblems && problem.subproblems.length > 0) {
          const childrenWrapper = document.createElement('div');
          childrenWrapper.className = 'children';
          
          const connector = document.createElement('div');
          connector.className = 'connector';
          childrenWrapper.appendChild(connector);
          
          const subLevel = document.createElement('div');
          subLevel.className = 'level horizontal';
          
          problem.subproblems.forEach(subproblem => {
            subLevel.appendChild(createSubproblemTree(subproblem));
          });
          
          childrenWrapper.appendChild(subLevel);
          nodeContainer.appendChild(childrenWrapper);
        }
        
        treeWrapper.appendChild(nodeContainer);
      });
      
      treeContainer.appendChild(treeWrapper);
    }

    function createSubproblemTree(problem) {
      const container = document.createElement('div');
      container.appendChild(createNodeElement(problem));
      
      if (problem.subproblems && problem.subproblems.length > 0) {
        const childrenWrapper = document.createElement('div');
        childrenWrapper.className = 'children';
        
        const connector = document.createElement('div');
        connector.className = 'connector';
        childrenWrapper.appendChild(connector);
        
        const subLevel = document.createElement('div');
        subLevel.className = 'level horizontal';
        
        problem.subproblems.forEach(subproblem => {
          subLevel.appendChild(createSubproblemTree(subproblem));
        });
        
        childrenWrapper.appendChild(subLevel);
        container.appendChild(childrenWrapper);
      }
      
      return container;
    }

    function showEmptyState() {
      treeContainer.innerHTML = `
        <div class="empty-state">
          <p>Nenhum processo adicionado ainda.</p>
          <p>Adicione um processo ou carregue um arquivo para come√ßar.</p>
        </div>
      `;
    }

    function calculateTotalNodes(problemList) {
      let count = problemList.length;
      problemList.forEach(problem => {
        if (problem.subproblems && problem.subproblems.length > 0) {
          count += calculateTotalNodes(problem.subproblems);
        }
      });
      return count;
    }

    function calculateCompletedNodes(problemList) {
      let count = 0;
      problemList.forEach(problem => {
        if (problem.completed) count++;
        if (problem.subproblems && problem.subproblems.length > 0) {
          count += calculateCompletedNodes(problem.subproblems);
        }
      });
      return count;
    }

    function createNodeElement(problem) {
      const node = document.createElement('div');
      node.className = 'node';
      node.dataset.id = problem.id;
      
      if (problem.completed) {
        node.classList.add('completed');
      }
      
      const title = document.createElement('div');
      title.className = 'node-title';
      title.textContent = problem.title;
      
      const description = document.createElement('div');
      description.className = 'node-description';
      description.textContent = problem.description || 'Sem descri√ß√£o';
      
      const actions = document.createElement('div');
      actions.className = 'node-actions';
      
      if (!problem.completed) {
        const completeBtn = document.createElement('button');
        completeBtn.className = 'success';
        completeBtn.textContent = '‚úì Concluir';
        completeBtn.addEventListener('click', () => completeProblem(problem.id));
        actions.appendChild(completeBtn);
      } else {
        const uncompleteBtn = document.createElement('button');
        uncompleteBtn.className = 'warning';
        uncompleteBtn.textContent = '‚Ü∂ Reabrir';
        uncompleteBtn.addEventListener('click', () => uncompleteProblem(problem.id));
        actions.appendChild(uncompleteBtn);
      }
      
      const editBtn = document.createElement('button');
      editBtn.className = 'warning';
      editBtn.textContent = '‚úèÔ∏è Editar';
      editBtn.addEventListener('click', () => editProblem(problem.id));
      actions.appendChild(editBtn);
      
      const addSubBtn = document.createElement('button');
      addSubBtn.textContent = '‚ûï Sub';
      addSubBtn.addEventListener('click', () => addSubproblem(problem.id));
      actions.appendChild(addSubBtn);
      
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'danger';
      deleteBtn.textContent = 'üóëÔ∏è';
      deleteBtn.addEventListener('click', () => deleteProblem(problem.id));
      actions.appendChild(deleteBtn);
      
      node.appendChild(title);
      node.appendChild(description);
      node.appendChild(actions);
      
      return node;
    }

    function completeProblem(id) {
      const problem = findProblem(id, problems);
      if (problem) {
        problem.completed = true;
        buildTree();
      }
    }

    function uncompleteProblem(id) {
      const problem = findProblem(id, problems);
      if (problem) {
        problem.completed = false;
        buildTree();
      }
    }

    function editProblem(id) {
      const problem = findProblem(id, problems);
      if (problem) {
        editingId = id;
        modalTitle.textContent = 'Editar Processo';
        problemTitle.value = problem.title;
        problemDescription.value = problem.description || '';
        problemModal.style.display = 'flex';
        problemTitle.focus();
      }
    }

    function deleteProblem(id) {
      if (confirm('Tem certeza que deseja excluir este processo e todos os seus subprocessos?')) {
        removeFromProblems(id, problems);
        updateButtons();
        buildTree();
      }
    }

    function removeFromProblems(id, problemList) {
      for (let i = problemList.length - 1; i >= 0; i--) {
        if (problemList[i].id === id) {
          problemList.splice(i, 1);
          return true;
        }
        if (problemList[i].subproblems && removeFromProblems(id, problemList[i].subproblems)) {
          return true;
        }
      }
      return false;
    }

    function addSubproblem(parentId) {
      const parentProblem = findProblem(parentId, problems);
      if (parentProblem) {
        openModal(parentId, `Adicionar Subprocesso para "${parentProblem.title}"`);
      }
    }

    function findProblem(id, problemList) {
      for (const problem of problemList) {
        if (problem.id === id) return problem;
        if (problem.subproblems) {
          const found = findProblem(id, problem.subproblems);
          if (found) return found;
        }
      }
      return null;
    }

    function updateProgressBar() {
      const percentage = totalNodes > 0 ? Math.round((completedNodes / totalNodes) * 100) : 0;
      progressBar.style.width = `${percentage}%`;
      progressBar.textContent = `${completedNodes}/${totalNodes} (${percentage}%)`;
    }

    updateButtons();
    showEmptyState();
  </script>
</body>
</html>
